<?xml version="1.0" encoding="UTF-8"?><Db flnm="BarramentoDb" nm="corporativo" ver="1.3.4">
  <VerLbl/>
  <VerNotes/>
  <DefTblOpts/>
  <DocFolder>C:\DiagramaTabelas</DocFolder>
  <Sch Cm="Subsistema Controle de Acesso" nm="controleacesso">
    <Tbl UsSo="1" nm="acesso">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_sessao, id_aplicacao" nm="pk_acesso"/>
      <Cl au="0" df="" nm="id_sessao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="now()" nm="primeiro_acesso" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="now()" nm="ultimo_acesso" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_acesso_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="acesso" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_acesso_sessao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="sessao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="acesso" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_sessao" prCl="id"/>
      </Fk>
      <Idx clu="0" nm="idx_acesso_01" unq="0">
        <ClNs>id_sessao</ClNs>
      </Idx>
      <Trg del="1" eaRow="1" exBe="1" ins="0" nm="trg_acesso_b_d" upd="0">
        <Sql>controleacesso.fc_trg_acesso_b_d()</Sql>
      </Trg>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="acesso_historico">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_sessao, id_aplicacao, primeiro_acesso" nm="pk_acesso_historico"/>
      <Cl au="0" df="nextval('controleacesso.sessao_id_seq'::regclass)" nm="id_sessao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="primeiro_acesso" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ultimo_acesso" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="aplicacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="aplicacao_pkey"/>
      <Cl au="1" df="nextval('aplicacao_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="Text" en="" id="703" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="100" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="contexto" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="logo" nu="1">
        <DT arr="0" ds="lo" en="" id="5001" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_orgao_gestor" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="cd_sistema" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="10" sc="null" sg="1" un="0"/>
      </Cl>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_aplicacao_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_aplicacao_01">
          <ClNs>contexto</ClNs>
        </UnCon>
        <UnCon nm="uc_aplicacao_02">
          <ClNs>nome</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="broker">
      <TblOpts/>
      <Pk ClNs="id" nm="pkbroker"/>
      <Cl au="0" df="" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="endereco" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="password" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="funcionalidade">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="funcionalidade_pkey"/>
      <Cl au="1" df="nextval('funcionalidade_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="200" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_funcionalidade_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="funcionalidade" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_funcionalidade_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_usuario_b_i" upd="0">
        <Sql>controleacesso.fc_trg_funcionalidade_b_i()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_funcionalidade_01">
          <ClNs>codigo</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="historico_senha">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_historico_senha"/>
      <Cl au="0" df="nextval('controleacesso.sq_historico_senha'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_hora" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="senha" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_historico_senha_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="historico_senha" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_historico_senha_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="historico_situacao">
      <Cm>Historico da situacao do usuario</Cm>
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_historico_situacao"/>
      <Cl au="0" df="nextval('controleacesso.sq_historico_situacao'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="motivo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="250" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="situacao" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_historico_situacao_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="historico_situacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_historico_situacao_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="operacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="operacao_pkey"/>
      <Cl au="1" df="nextval('operacao_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="100" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_funcionalidade" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_operacao_funcionalidade" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="funcionalidade" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_funcionalidade" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_operacao_b_i" upd="0">
        <Sql>controleacesso.fc_trg_operacao_b_i()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_operacao_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_operacao_01">
          <ClNs>codigo</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="parametro">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_configuracao"/>
      <Cl au="0" df="nextval('controleacesso.sq_configuracao'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="100" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_tipo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="valor" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="300" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_configuracao_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="1"/>
        <CdTb mn="1" nm="parametro" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_parametro_gera_log_a_iu" upd="1">
        <Sql>fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_configuracao_01">
          <ClNs>id_aplicacao, nome</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="perfil">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="perfil_pkey"/>
      <Cl au="1" df="nextval('perfil_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="200" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="false" nm="gerente_delega" nu="0">
        <DT arr="0" ds="Boolean" en="" id="16" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="false" nm="gerente_orgao_delega" nu="0">
        <DT arr="0" ds="Boolean" en="" id="16" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_perfil_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_perfil_b_i" upd="0">
        <Sql>controleacesso.fc_trg_perfil_b_i()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_perfil_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_perfil_01">
          <ClNs>codigo</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="perfil_operacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_perfil, id_operacao" nm="pk_perfil_operacao"/>
      <Cl au="0" df="" nm="id_perfil" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_operacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_perfil_operacao_operacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="operacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="perfil_operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_operacao" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_perfil_operacao_perfil" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="perfil" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="perfil_operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_perfil" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="servico">
      <TblOpts/>
      <Pk ClNs="id" nm="pkservico"/>
      <Cl au="0" df="" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome" nu="0">
        <DT arr="0" ds="VarBinary" en="" id="-3" ln="100" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="Text" en="" id="703" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="logo" nu="0">
        <DT arr="0" ds="lo" en="" id="5001" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="cd_servico" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="10" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_servicos_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="servico" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="servico_servicoRPC">
      <TblOpts/>
      <Pk ClNs="id" nm="pkservico_servicoRPC"/>
      <Cl au="0" df="" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_servico" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_servicorpc" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_servico_servicoRPC_servicorpc" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="servicorpc" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="servico_servicoRPC" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_servicorpc" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_servico_servicoRPC_servicos" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="servico" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="servico_servicoRPC" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_servico" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="servicorpc">
      <TblOpts/>
      <Pk ClNs="id" nm="pkservicorpc"/>
      <Cl au="0" df="" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="usuario" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="password" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_broker" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_servicorpc_broker" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="broker" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="servicorpc" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_broker" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="sessao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_sessao"/>
      <Cl au="0" df="nextval('controleacesso.sessao_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="passaporte" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="200" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_sessao_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="sessao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <Idx clu="0" nm="idx_sessao_01" unq="1">
        <ClNs>passaporte</ClNs>
      </Idx>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="usuario_pkey"/>
      <Cl au="1" df="nextval('usuario_id_seq'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="login" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="senha" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="1" nm="situacao" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_orgao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="0" nm="trocou_senha" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="email" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="nome_fon" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="0" nm="tipo_documento" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="numero_documento" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Idx clu="0" nm="idx_usuario_02" unq="0">
        <ClNs>id_orgao</ClNs>
      </Idx>
      <Idx clu="0" nm="idx_usuario_u_01" unq="1">
        <ClNs>tipo_documento, numero_documento</ClNs>
      </Idx>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_usuario_a_i" upd="0">
        <Sql>controleacesso.fc_trg_usuario_a_i()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_usuario_b_iu" upd="1">
        <Sql>controleacesso.fc_trg_usuario_b_iu()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_usuario_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="usuario_login_key">
          <ClNs>login</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario_aplicacao">
      <TblOpts/>
      <Pk ClNs="id" nm="pkusuario_aplicacao"/>
      <Cl au="1" df="" nm="id" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="cd_usuario_natural" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="50" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_usuario_aplicacao_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_aplicacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_usuario_aplicacao_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_aplicacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario_complemento">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_usuario" nm="pk_usuario_complemento"/>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="imagem" nu="1">
        <DT arr="0" ds="lo" en="" id="5001" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="now()" nm="data_manut" nu="0">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_usuario_complemento_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_complemento" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_usuario_complemento_gera_log_a_iu" upd="1">
        <Sql>fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario_perfil">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_usuario, id_perfil" nm="pk_usuario_perfil"/>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_perfil" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_usuario_perfil_perfil" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="perfil" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_perfil" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_usuario_perfil_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_usuario_perfil_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_usuario_perfil_01">
          <ClNs>id_usuario, id_perfil</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario_perfil_aplicacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_usuario, id_perfil, id_aplicacao" nm="pk_usuario_perfil_aplicacao"/>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_perfil" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_usuario_perfil_aplicacao_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_perfil_aplicacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_usuario_perfil_aplicacao_usuario_perfil" prLkCl="id_usuario" upAc="3">
        <PrTb mn="0" nm="usuario_perfil" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_perfil_aplicacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id_usuario"/>
        <ClPr cdCl="id_perfil" prCl="id_perfil"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_usuario_perfil_aplicacao_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_usuario_perfil_aplicacao_01">
          <ClNs>id_usuario, id_perfil, id_aplicacao</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="usuario_servico">
      <Cm>serviços disponiveis para o usuário</Cm>
      <TblOpts/>
      <Pk ClNs="id" nm="pkusuario_servico"/>
      <Cl au="0" df="" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_servico" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_usuario_servico_servicos" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="servico" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_servico" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_servico" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_usuario_servico_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="usuario_servico" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <UniqueConstraints/>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="ws_operacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_ws_operacao"/>
      <Cl au="0" df="nextval('controleacesso.sq_ws_operacao'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="100" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_ws_operacao_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_ws_operacao_b_i" upd="0">
        <Sql>controleacesso.fc_trg_ws_operacao_b_i()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_ws_operacao_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_ws_operacao_01">
          <ClNs>codigo</ClNs>
        </UnCon>
        <UnCon nm="uc_ws_operacao_02">
          <ClNs>id_aplicacao, descricao</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="ws_perfil">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="pk_ws_perfil"/>
      <Cl au="0" df="nextval('controleacesso.sq_ws_perfil'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="200" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_aplicacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_ws_perfil_aplicacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="aplicacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_aplicacao" prCl="id"/>
      </Fk>
      <Trg del="0" eaRow="1" exBe="1" ins="1" nm="trg_ws_perfil_b_i" upd="0">
        <Sql>controleacesso.fc_trg_ws_perfil_b_i()</Sql>
      </Trg>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_ws_perfil_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_ws_perfil_01">
          <ClNs>codigo</ClNs>
        </UnCon>
        <UnCon nm="uc_ws_perfil_02">
          <ClNs>id_aplicacao, descricao</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="ws_perfil_ws_operacao">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_perfil, id_operacao" nm="pk_ws_perfil_ws_operacao"/>
      <Cl au="0" df="" nm="id_perfil" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_operacao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_ws_perfil_ws_operacao_ws_operacao" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="ws_operacao" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_perfil_ws_operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_operacao" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_ws_perfil_ws_operacao_ws_perfil" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="ws_perfil" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_perfil_ws_operacao" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_perfil" prCl="id"/>
      </Fk>
      <UniqueConstraints>
        <UnCon nm="uc_ws_perfil_ws_operacao_01">
          <ClNs>id_perfil, id_operacao</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="ws_usuario">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id" nm="ws_usuario_pkey"/>
      <Cl au="0" df="nextval('controleacesso.sq_ws_usuario'::regclass)" nm="id" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="login" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="descricao" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="senha" nu="0">
        <DT arr="0" ds="VarChar" en="" id="12" ln="255" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="1" nm="ativo" nu="0">
        <DT arr="0" ds="Integer" en="" id="4" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_orgao" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="ultimo_acesso" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="data_manut" nu="1">
        <DT arr="0" ds="TimeStamp" en="" id="93" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_usuario_manut" nu="1">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="codigo_operacao_manut" nu="1">
        <DT arr="0" ds="VarChar" en="" id="12" ln="20" sc="null" sg="1" un="0"/>
      </Cl>
      <Idx clu="0" nm="idx_ws_usuario_u_01" unq="1">
        <ClNs>login</ClNs>
      </Idx>
      <Trg del="0" eaRow="1" exBe="0" ins="1" nm="trg_ws_usuario_gera_log_a_iu" upd="1">
        <Sql>auditoria.fc_trg_gera_log_a_iu()</Sql>
      </Trg>
      <UniqueConstraints>
        <UnCon nm="uc_ws_usuario_01">
          <ClNs>login</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Tbl UsSo="1" nm="ws_usuario_ws_perfil">
      <TblOpts>WITHOUT OIDS</TblOpts>
      <Pk ClNs="id_usuario, id_perfil" nm="pk_ws_usuario_ws_perfil"/>
      <Cl au="0" df="" nm="id_usuario" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Cl au="0" df="" nm="id_perfil" nu="0">
        <DT arr="0" ds="BigInt" en="" id="-5" ln="null" sc="null" sg="1" un="0"/>
      </Cl>
      <Fk deAc="3" nm="fk_ws_usuario_ws_perfil_ws_perfil" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="ws_perfil" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_usuario_ws_perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_perfil" prCl="id"/>
      </Fk>
      <Fk deAc="3" nm="fk_ws_usuario_ws_perfil_ws_usuario" prLkCl="id" upAc="3">
        <PrTb mn="0" nm="ws_usuario" oe="1" sch="controleacesso" zr="0"/>
        <CdTb mn="1" nm="ws_usuario_ws_perfil" oe="0" sch="controleacesso" zr="1"/>
        <ClPr cdCl="id_usuario" prCl="id"/>
      </Fk>
      <UniqueConstraints>
        <UnCon nm="uc_ws_usuario_ws_perfil_01">
          <ClNs>id_usuario, id_perfil</ClNs>
        </UnCon>
      </UniqueConstraints>
      <SchTrHis/>
    </Tbl>
    <Proc nm="fc_atualizar_acesso(p_passaporte character varying, p_id_aplicacao bigint, p_login character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_atualizar_acesso(p_passaporte character varying, p_id_aplicacao bigint, p_login character varying) 
  RETURNS integer AS 
$$
/*
  Retorno:
  0 - Sem problema
  1 - Sem sessao
  2 - Sessao e login nao conferem
*/
declare
  r_sessao record;
  v_retorno integer default 0;
begin
  -- Localiza a sessao
  select s.id, u.login into r_sessao
  from 
    controleacesso.sessao s
    join controleacesso.usuario u on u.id = s.id_usuario
  where 
    s.passaporte = p_passaporte;

  if r_sessao.id is null then
    -- Nao tem sessao
    v_retorno := 1;
    raise NOTICE 'Passaporte % não tem sessão.', p_passaporte;
  elsif p_login is not null and r_sessao.login &lt;&gt; p_login then
    -- Sessao e login nao conferem
    v_retorno := 2;
    raise NOTICE 'Passaporte % e login % não conferem.', p_passaporte, p_login;
  else
    -- Atualiza o acesso
    update controleacesso.acesso set
      ultimo_acesso = current_timestamp
    where
      id_sessao = v_id_sessao and
      id_aplicacao = p_id_aplicacao;

    if not found then
      insert into controleacesso.acesso
        (id_sessao, id_aplicacao)
      values(v_id_sessao, p_id_aplicacao);
    end if; -- if not found then
  end if; -- if r_sessao.id is null then

  -- retorno
  return v_retorno;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_estatistica_usuarios(p_periodo_inicio timestamp without time zone, p_periodo_fim timestamp without time zone, p_intervalo character varying, p_id_orgao bigint, p_id_aplicacao bigint)">
      <src>CREATE OR REPLACE FUNCTION fc_estatistica_usuarios(p_periodo_inicio timestamp without time zone, p_periodo_fim timestamp without time zone, p_intervalo character varying, p_id_orgao bigint, p_id_aplicacao bigint) 
  RETURNS SETOF controleacesso.type_estatistica_usuarios AS 
$$
/*
  Descricao:
    Retorna o total de usuarios fazendo acessos por intervalo no periodo
  Uso:
  Total de usuarios por orgao e aplicacao no periodo: passar o id do orgao ou aplicacao, ou null para incluir todos
  Total de usuarios por aplicacao no periodo: passar -1 no parametro p_id_orgao, o id da aplicacao ou null para todas
  Total de usuarios por orgao no periodo: passar -1 no parametro p_id_aplicacao, o id do orgao ou null para todos
  Total de usuarios no periodo: passar -1 nos parametros p_id_aplicacao e p_id_orgao
*/
declare
  v_data_hora timestamp default null;
  v_incremento interval default null;
begin
  -- Prepara a tabela de apoio
  drop table if exists tmp_fc_estatistica_acessos;
  create local temporary table tmp_fc_estatistica_acessos (
    data_hora timestamp not null,
    id_orgao bigint null,
    id_aplicacao bigint null,
    total_usuarios bigint not null default 0
	);

  -- Calcula o inicio da estatistica
  case
    when p_periodo_inicio is null then 
      v_data_hora := date_trunc(p_intervalo, current_timestamp);
    else 
      v_data_hora := date_trunc(p_intervalo, p_periodo_inicio);
  end case;    

  -- Calcula o incremento
  select cast('1 ' || p_intervalo as interval) into v_incremento;

  -- Calcula o total de usuarios por intervalo de tempo
  loop
    case
      -- Total de usuarios por orgao e aplicacao no periodo
      when (p_id_orgao is null or p_id_orgao &lt;&gt; -1) and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
        insert into tmp_fc_estatistica_acessos
          (data_hora, id_orgao, id_aplicacao, total_usuarios)
        select data_hora, id_orgao, id_aplicacao, count(id_usuario)
        from 
          (
            select v_data_hora as data_hora, u.id_orgao, ah.id_aplicacao, ah.id_usuario
            from 
              controleacesso.acesso_historico ah
              join controleacesso.usuario u on u.id = ah.id_usuario
              join controleacesso.aplicacao a on a.id = ah.id_aplicacao
            where
              v_data_hora between date_trunc(p_intervalo, ah.primeiro_acesso) and date_trunc(p_intervalo, ah.ultimo_acesso) and
              (p_id_aplicacao is null or ah.id_aplicacao = p_id_aplicacao) and
              (p_id_orgao is null or u.id_orgao = p_id_orgao)
            union
            select v_data_hora, u.id_orgao, a.id_aplicacao, u.id
            from
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
                join controleacesso.usuario u on u.id = s.id_usuario
                  join nucleopa.orgao o on o.id_orgao = u.id_orgao
              join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
            where
              v_data_hora between date_trunc(p_intervalo, a.primeiro_acesso) and date_trunc(p_intervalo, a.ultimo_acesso) and
              (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao) and
              (p_id_orgao is null or u.id_orgao = p_id_orgao)
          ) e
        group by data_hora, id_orgao, id_aplicacao;

      -- Total de usuarios por aplicacao no periodo
      when p_id_orgao = -1 and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
        insert into tmp_fc_estatistica_acessos
          (data_hora, id_aplicacao, total_usuarios)
        select data_hora, id_aplicacao, count(id_usuario)
        from 
          (
            select v_data_hora as data_hora, ah.id_aplicacao, ah.id_usuario
            from 
              controleacesso.acesso_historico ah
              join controleacesso.aplicacao a on a.id = ah.id_aplicacao
            where
              v_data_hora between date_trunc(p_intervalo, ah.primeiro_acesso) and date_trunc(p_intervalo, ah.ultimo_acesso) and
              (p_id_aplicacao is null or ah.id_aplicacao = p_id_aplicacao)
            union
            select v_data_hora, a.id_aplicacao, s.id_usuario
            from
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
              join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
            where
              v_data_hora between date_trunc(p_intervalo, a.primeiro_acesso) and date_trunc(p_intervalo, a.ultimo_acesso) and
              (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao)
          ) e
        group by data_hora, id_aplicacao;

      -- Total de usuarios por orgao no periodo
      when p_id_aplicacao = -1 and (p_id_orgao is null or p_id_orgao &lt;&gt; -1) then
        insert into tmp_fc_estatistica_acessos
          (data_hora, id_orgao, total_usuarios)
        select data_hora, id_orgao, count(id_usuario)
        from 
          (
            select v_data_hora as data_hora, u.id_orgao, ah.id_usuario
            from 
              controleacesso.acesso_historico ah
              join controleacesso.usuario u on u.id = ah.id_usuario
            where
              v_data_hora between date_trunc(p_intervalo, ah.primeiro_acesso) and date_trunc(p_intervalo, ah.ultimo_acesso) and
              (p_id_orgao is null or u.id_orgao = p_id_orgao)
            union
            select v_data_hora, u.id_orgao, u.id
            from
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
                join controleacesso.usuario u on u.id = s.id_usuario
                  join nucleopa.orgao o on o.id_orgao = u.id_orgao
            where
              v_data_hora between date_trunc(p_intervalo, a.primeiro_acesso) and date_trunc(p_intervalo, a.ultimo_acesso) and
              (p_id_orgao is null or u.id_orgao = p_id_orgao)
          ) e
        group by data_hora, id_orgao;

      -- Total de usuarios no periodo
      else 
        insert into tmp_fc_estatistica_acessos
          (data_hora, total_usuarios)
        select v_data_hora as data_hora, count(id_usuario)
        from
          (
            select distinct s.id_usuario
            from 
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
            group by s.id, s.id_usuario
            having v_data_hora between date_trunc(p_intervalo, min(a.primeiro_acesso)) and date_trunc(p_intervalo, max(a.ultimo_acesso))
            union
            select distinct id_usuario
            from controleacesso.acesso_historico
            group by id_sessao, id_usuario
            having v_data_hora between date_trunc(p_intervalo, min(primeiro_acesso)) and date_trunc(p_intervalo, max(ultimo_acesso))
          ) e
        group by data_hora;
    end case;

    -- Incrementa o intervalo
    v_data_hora := v_data_hora + v_incremento;

    -- Sai se passou do fim do periodo
    exit when (p_periodo_fim is null) or (v_data_hora &gt; p_periodo_fim);
  end loop;

  -- retorno
  return query select data_hora, id_orgao, id_aplicacao, total_usuarios from tmp_fc_estatistica_acessos;
  return;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100
  ROWS 1000;</src>
    </Proc>
    <Proc nm="fc_estatistica_usuarios_logados(p_id_orgao bigint, p_id_aplicacao bigint)">
      <src>CREATE OR REPLACE FUNCTION fc_estatistica_usuarios_logados(p_id_orgao bigint, p_id_aplicacao bigint) 
  RETURNS SETOF controleacesso.type_estatistica_usuarios AS 
$$
/*
  Descricao:
    Retorna o total de usuarios logados no intervalo do periodo
  Uso:
  Total de usuarios por orgao e aplicacao no periodo: passar o id do orgao ou aplicacao, ou null para incluir todos
  Total de usuarios por aplicacao no periodo: passar -1 no parametro p_id_orgao, o id da aplicacao ou null para todas
  Total de usuarios por orgao no periodo: passar -1 no parametro p_id_aplicacao, o id do orgao ou null para todos
  Total de usuarios no periodo: passar -1 nos parametros p_id_aplicacao e p_id_orgao
*/
declare
begin
  -- Prepara a tabela de apoio
  drop table if exists tmp_fc_estatistica_usuarios_logados;
  create local temporary table tmp_fc_estatistica_usuarios_logados (
    data_hora timestamp not null,
    id_orgao bigint null,
    id_aplicacao bigint null,
    total_usuarios bigint not null default 0
	);

  -- Calcula o total de usuarios
  case
    -- Total de usuarios por orgao e aplicacao
    when (p_id_orgao is null or p_id_orgao &lt;&gt; -1) and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
      insert into tmp_fc_estatistica_usuarios_logados
        (data_hora, id_orgao, id_aplicacao, total_usuarios)
      select localtimestamp, u.id_orgao, a.id_aplicacao, count(s.id_usuario)
      from
        controleacesso.acesso a
        join controleacesso.sessao s on s.id = a.id_sessao
          join controleacesso.usuario u on u.id = s.id_usuario
        join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
      where
        (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao) and
        (p_id_orgao is null or u.id_orgao = p_id_orgao)
      group by localtimestamp, u.id_orgao, a.id_aplicacao;

    -- Total de usuarios por aplicacao
    when p_id_orgao = -1 and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
      insert into tmp_fc_estatistica_usuarios_logados
        (data_hora, id_aplicacao, total_usuarios)
      select localtimestamp, a.id_aplicacao, count(s.id_usuario)
      from
        controleacesso.acesso a
        join controleacesso.sessao s on s.id = a.id_sessao
        join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
      where
        (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao)
      group by localtimestamp, id_aplicacao;

    -- Total de usuarios por orgao
    when p_id_aplicacao = -1 and (p_id_orgao is null or p_id_orgao &lt;&gt; -1) then
      insert into tmp_fc_estatistica_usuarios_logados
        (data_hora, id_orgao, total_usuarios)
      select localtimestamp, u.id_orgao, count(s.id_usuario)
      from
        controleacesso.acesso a
        join controleacesso.sessao s on s.id = a.id_sessao
          join controleacesso.usuario u on u.id = s.id_usuario
      where
        (p_id_orgao is null or u.id_orgao = p_id_orgao)
      group by localtimestamp, u.id_orgao;

    -- Total de usuarios
    else 
      insert into tmp_fc_estatistica_usuarios_logados
        (data_hora, total_usuarios)
      select localtimestamp, count(s.id_usuario)
      from controleacesso.sessao s
      group by localtimestamp;
  end case;

  -- retorno
  return query select data_hora, id_orgao, id_aplicacao, total_usuarios from tmp_fc_estatistica_usuarios_logados;
  return;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100
  ROWS 1000;</src>
    </Proc>
    <Proc nm="fc_gera_script_implantacao(p_acao text, p_id_aplicacao bigint, p_id_usuario bigint, p_versao text, p_imagem_path text)">
      <src>CREATE OR REPLACE FUNCTION fc_gera_script_implantacao(p_acao text, p_id_aplicacao bigint, p_id_usuario bigint, p_versao text, p_imagem_path text) 
  RETURNS text AS 
$$
declare 
  v_retorno text default '';
  v_linha text default '';
  v_sql_update text default '';
  v_sql_insert text default '';
  r_tupla record;
  v_acao text default lower(p_acao);
  v_imagem text default null;
begin
  if v_acao not in ('implantar', 'atualizar') then
    v_retorno := 'Acao invalida';
  end if;

  -- Verifica se os parametros foram passados
  if v_retorno = '' then
    select 
      '/* ' || e'\r' ||'  Script para implantar a versao ' || p_versao || ' do sistema ' || a.nome || e'\r' || '*/' || e'\r',
      case when a.logo is null then null else replace(p_imagem_path || replace(a.contexto, ' ', '_') || '.jpg', '//', '/') end
    into v_retorno, v_imagem
    from controleacesso.aplicacao a
    where a.id = p_id_aplicacao;

    -- controleacesso.aplicacao
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.aplicacao ' || e'\r';
    if v_acao = 'atualizar' then
      select 
        'update controleacesso.aplicacao as u set ' || 
        'descricao = ' || quote_literal(a.descricao) || ', ' ||
        'ativo = ' || a.ativo || ', ' ||
        'nome = ' || quote_literal(a.nome) || ', ' ||
        'contexto = ' || quote_literal(a.contexto) || ', ' ||
        'id_orgao_gestor = ' || a.id_orgao_gestor || ', ' ||
        'data_manut = current_timestamp , ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        coalesce(', logo = lo_import(' || quote_literal(v_imagem) || ')', '') || 
        'where ' ||
        'id = ' || a.id || ' and (' ||
        'descricao &lt;&gt; ' || quote_literal(a.descricao) || ' or ' ||
        'ativo &lt;&gt; ' || a.ativo || ' or ' ||
        'nome &lt;&gt; ' || quote_literal(a.nome) || ' or ' ||
        'contexto &lt;&gt; ' || quote_literal(a.contexto) || ' or ' ||
        'id_orgao_gestor &lt;&gt; ' || a.id_orgao_gestor || 
        ');'
      into v_linha
      from controleacesso.aplicacao a
      where a.id = p_id_aplicacao;
    else
      select 
        'insert into controleacesso.aplicacao ' || 
        '(id, descricao, ativo, nome, contexto, id_orgao_gestor, data_manut, id_usuario_manut' ||
        case when v_imagem is null then '' else ', logo' end ||
        ') select ' ||
        a.id || ', ' ||
        quote_literal(a.descricao) || ', ' || 
        a.ativo || ', ' || 
        quote_literal(a.nome) || ', ' || 
        quote_literal(a.contexto) || ', ' || 
        a.id_orgao_gestor || ', ' || 
        'current_timestamp, ' ||
        p_id_usuario ||
        coalesce(', lo_import(' || quote_literal(v_imagem) || ')', '') ||
        ' where not exists(select 1 from controleacesso.aplicacao where id = ' || a.id || ');'
      into v_linha
      from controleacesso.aplicacao a
      where a.id = p_id_aplicacao;
    end if; -- controleacesso.aplicacao
    v_retorno := v_retorno || v_linha || e'\r';

    -- controleacesso.parametro
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.parametro ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.parametro as u set ' ||
        'id_aplicacao = ' || c.id_aplicacao || ', ' ||
        'nome = ' || quote_literal(c.nome) || ', ' ||
        'descricao = ' || quote_literal(c.descricao) || ', ' ||
        'id_tipo = ' || c.id_tipo || ' ' || ', ' ||
        'data_manut = current_timestamp, ' || 
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || c.id || ' and (' ||
        'id_aplicacao &lt;&gt; ' || c.id_aplicacao || ' or ' ||
        'nome &lt;&gt; ' || quote_literal(c.nome) || ' or ' ||
        'descricao &lt;&gt; ' || quote_literal(c.descricao) || ' or ' ||
        'id_tipo &lt;&gt; ' || c.id_tipo || 
        ');' as sql_update,
        'insert into controleacesso.parametro ' ||
        '(id, id_aplicacao, nome, descricao, id_tipo, valor, data_manut, id_usuario_manut) ' || 
        'select ' ||
        c.id || ', ' || 
        c.id_aplicacao || ', ' || 
        quote_literal(c.nome) || ', ' || 
        quote_literal(c.descricao) || ', ' || 
        c.id_tipo || ', ' || 
        quote_literal(c.valor) || ', ' || 
        'current_timestamp, ' || 
        p_id_usuario || 
        ' where not exists(select 1 from controleacesso.parametro where id = ' || c.id || ');' as sql_insert
      from controleacesso.parametro c
      where c.id_aplicacao is null or c.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.parametro
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');
  
    -- controleacesso.perfil
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.perfil ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.perfil as u set ' ||
        'descricao = ' || quote_literal(p.descricao) || ', ' ||
        'ativo = ' || p.ativo || ', ' ||
        'id_aplicacao = ' || p.id_aplicacao || ', ' ||
        'gerente_delega = ' || p.gerente_delega || ', ' ||
        'gerente_orgao_delega = ' || p.gerente_orgao_delega || ', ' ||
        'codigo = ' || quote_literal(p.codigo) || ', ' ||
        'data_manut = current_timestamp, ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || p.id || ' and (' ||
        'descricao &lt;&gt; ' || quote_literal(p.descricao) || ' or ' ||
        'ativo &lt;&gt; ' || p.ativo || ' or ' ||
        'gerente_delega &lt;&gt; ' || p.gerente_delega || ' or ' ||
        'gerente_orgao_delega &lt;&gt; ' || p.gerente_orgao_delega || ' or ' ||
        'codigo &lt;&gt; ' || quote_literal(p.codigo) || 
        ');' as sql_update,
        case when p.ativo = 0 
          then '' 
          else
            'insert into controleacesso.perfil ' ||
            '(id, descricao, ativo, id_aplicacao, gerente_delega, gerente_orgao_delega, codigo, data_manut, id_usuario_manut) ' || 
            'select ' ||
            p.id || ', ' || 
            quote_literal(p.descricao) || ', ' || 
            p.ativo || ', ' || 
            p.id_aplicacao || ', ' || 
            p.gerente_delega || ', ' || 
            p.gerente_orgao_delega || ', ' || 
            quote_literal(p.codigo) || ', ' || 
            'current_timestamp, ' || 
            p_id_usuario || 
            ' where not exists(select 1 from controleacesso.perfil where id = ' || p.id || ');'
        end as sql_insert
      from controleacesso.perfil p
      where p.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.perfil
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.funcionalidade
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.funcionalidade ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.funcionalidade as u set ' ||
        'descricao = ' || quote_literal(f.descricao) || ', ' ||
        'codigo = ' || quote_literal(f.codigo) || ', ' ||
        'ativo = ' || f.ativo || ', ' ||
        'id_aplicacao = ' || f.id_aplicacao || ', ' ||
        'data_manut = current_timestamp, ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || f.id || ' and (' ||
        'descricao &lt;&gt; ' || quote_literal(f.descricao) || ' or ' ||
        'codigo &lt;&gt; ' || quote_literal(f.codigo) || ' or ' ||
        'ativo &lt;&gt; ' || f.ativo || 
        ');' as sql_update,
        case when f.ativo = 0 
          then null
          else
            'insert into controleacesso.funcionalidade ' ||
            '(id, descricao, codigo, ativo, id_aplicacao, data_manut, id_usuario_manut) ' || 
            'select ' ||
            f.id || ', ' || 
            quote_literal(f.descricao) || ', ' || 
            quote_literal(f.codigo) || ', ' || 
            f.ativo || ', ' || 
            f.id_aplicacao || ', ' || 
            'current_timestamp, ' || 
            p_id_usuario || 
            ' where not exists(select 1 from controleacesso.funcionalidade where id = ' || f.id || ');'
        end as sql_insert
      from controleacesso.funcionalidade f
      where f.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.funcionalidade
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.operacao
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.operacao ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.operacao as u set ' ||
        'descricao = ' || quote_literal(o.descricao) || ', ' ||
        'codigo = ' || quote_literal(o.codigo) || ', ' ||
        'ativo = ' || o.ativo || ', ' ||
        'id_funcionalidade = ' || o.id_funcionalidade || ', ' ||
        'id_aplicacao = ' || o.id_aplicacao || ', ' ||
        'data_manut = current_timestamp, ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || o.id || ' and (' ||
        'descricao &lt;&gt; ' || quote_literal(o.descricao) || ' or ' ||
        'codigo &lt;&gt; ' || quote_literal(o.codigo) || ' or ' ||
        'ativo &lt;&gt; ' || o.ativo || ' or ' ||
        'id_funcionalidade &lt;&gt; ' || o.id_funcionalidade || 
        ');' as sql_update,
        case when o.ativo = 0 
          then null
          else
            'insert into controleacesso.operacao ' ||
            '(id, descricao, codigo, ativo, id_funcionalidade, id_aplicacao, data_manut, id_usuario_manut) ' || 
            'select ' ||
            o.id || ', ' || 
            quote_literal(o.descricao) || ', ' || 
            quote_literal(o.codigo) || ', ' || 
            o.ativo || ', ' || 
            o.id_funcionalidade || ', ' || 
            o.id_aplicacao || ', ' || 
            'current_timestamp, ' || 
            p_id_usuario || 
            ' where not exists(select 1 from controleacesso.operacao where id = ' || o.id || ');'
        end as sql_insert
      from controleacesso.operacao o
      where o.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.operacao
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.perfil_operacao
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.perfil_operacao ' || e'\r';
    v_sql_insert := '';
    for r_tupla in
      select 
        'insert into controleacesso.perfil_operacao ' ||
        '(id_perfil, id_operacao) ' || 
        'select ' ||
        po.id_perfil || ', ' || 
        po.id_operacao || 
        ' where ' || 
        'not exists(select 1 from controleacesso.perfil_operacao where id_perfil = ' || po.id_perfil || ' and ' || 'id_operacao = ' || po.id_operacao || 
        ') and ' ||
        'exists(select 1 from controleacesso.perfil where id = ' || po.id_perfil || ') and ' ||
        'exists(select 1 from controleacesso.operacao where id = ' || po.id_operacao || ');' as sql_insert
      from 
        controleacesso.perfil_operacao po
        join controleacesso.perfil p on p.id = po.id_perfil
        join controleacesso.operacao o on o.id = po.id_operacao
      where 
        p.id_aplicacao = p_id_aplicacao and
        o.id_aplicacao = p_id_aplicacao
    loop
      v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
    end loop; -- controleacesso.perfil_operacao
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || 
        'delete from controleacesso.perfil_operacao po where ' ||
        'po.id_perfil in (select p.id from controleacesso.perfil p where p.id_aplicacao = ' || p_id_aplicacao || ') or ' ||
        'po.id_operacao in (select o.id from controleacesso.operacao o where o.id_aplicacao = ' || p_id_aplicacao || ');' || e'\r' || e'\r';
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.ws_perfil
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.ws_perfil ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.ws_perfil as u set ' ||
        'descricao = ' || quote_literal(wsp.descricao) || ', ' ||
        'ativo = ' || wsp.ativo || ', ' ||
        'id_aplicacao = ' || wsp.id_aplicacao || ', ' ||
        'codigo = ' || quote_literal(wsp.codigo) || ', ' ||
        'data_manut = current_timestamp, ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || wsp.id || ' and (' ||
        'descricao &lt;&gt; ' || quote_literal(wsp.descricao) || ' or ' ||
        'ativo &lt;&gt; ' || wsp.ativo || ' or ' ||
        'codigo &lt;&gt; ' || quote_literal(wsp.codigo) || 
        ');' as sql_update,
        'insert into controleacesso.ws_perfil ' ||
        '(id, descricao, ativo, id_aplicacao, codigo, data_manut, id_usuario_manut) ' || 
        'select ' ||
        wsp.id || ', ' || 
        quote_literal(wsp.descricao) || ', ' || 
        wsp.ativo || ', ' || 
        wsp.id_aplicacao || ', ' || 
        quote_literal(wsp.codigo) || ', ' || 
        'current_timestamp, ' || 
        p_id_usuario || 
        ' where not exists(select 1 from controleacesso.ws_perfil where id = ' || wsp.id || ');' as sql_insert
      from controleacesso.ws_perfil wsp
      where wsp.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.ws_perfil
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.ws_operacao
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.ws_operacao ' || e'\r';
    v_sql_update := '';
    v_sql_insert := '';
    for r_tupla in
      select 
        'update controleacesso.ws_operacao as u set ' ||
        'descricao = ' || quote_literal(wso.descricao) || ', ' ||
        'codigo = ' || quote_literal(wso.codigo) || ', ' ||
        'ativo = ' || wso.ativo || ', ' ||
        'id_aplicacao = ' || wso.id_aplicacao || ', ' ||
        'data_manut = current_timestamp, ' ||
        'id_usuario_manut = ' || p_id_usuario || ' ' ||
        'where u.id = ' || wso.id || ' and (' || 
        'descricao &lt;&gt; ' || quote_literal(wso.descricao) || ' or ' ||
        'codigo &lt;&gt; ' || quote_literal(wso.codigo) || ' or ' ||
        'ativo &lt;&gt; ' || wso.ativo || 
        ');' as sql_update,
        'insert into controleacesso.ws_operacao ' ||
        '(id, descricao, codigo, ativo, id_aplicacao, data_manut, id_usuario_manut) ' || 
        'select ' ||
        wso.id || ', ' || 
        quote_literal(wso.descricao) || ', ' || 
        quote_literal(wso.codigo) || ', ' || 
        wso.ativo || ', ' || 
        wso.id_aplicacao || ', ' || 
        'current_timestamp, ' || 
        p_id_usuario || 
        ' where not exists(select 1 from controleacesso.ws_operacao where id = ' || wso.id || ');' as sql_insert
      from controleacesso.ws_operacao wso
      where wso.id_aplicacao = p_id_aplicacao
    loop
      if v_acao = 'atualizar' then
        v_sql_update := v_sql_update || r_tupla.sql_update || e'\r';
      end if;
      if r_tupla.sql_insert is not null then
        v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
      end if;
    end loop; -- controleacesso.ws_operacao
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || coalesce(v_sql_update || e'\r', '');
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

    -- controleacesso.ws_perfil_ws_operacao
    v_retorno := v_retorno || e'\r' || e'\r' || '-- controleacesso.ws_perfil_ws_operacao ' || e'\r';
    v_sql_insert := '';
    for r_tupla in
      select 
        'insert into controleacesso.ws_perfil_ws_operacao ' ||
        '(id_perfil, id_operacao) ' || 
        'select ' ||
        wspo.id_perfil || ', ' || 
        wspo.id_operacao || 
        ' where not exists(select 1 from controleacesso.ws_perfil_ws_operacao where ' ||
        'id_perfil = ' || wspo.id_perfil || ' and ' ||
        'id_operacao = ' || wspo.id_operacao || ');' as sql_insert
      from 
        controleacesso.ws_perfil_ws_operacao wspo
        join controleacesso.ws_perfil wsp on wsp.id = wspo.id_perfil
        join controleacesso.ws_operacao wso on wso.id = wspo.id_operacao
      where 
        wsp.id_aplicacao = p_id_aplicacao or
        wso.id_aplicacao = p_id_aplicacao
    loop
      v_sql_insert := v_sql_insert || r_tupla.sql_insert || e'\r';
    end loop; -- controleacesso.ws_perfil_ws_operacao
    if v_acao = 'atualizar' then
      v_retorno := v_retorno || 
        'delete from controleacesso.ws_perfil_ws_operacao wspo where ' ||
        'wspo.id_perfil in (select wsp.id from controleacesso.ws_perfil wsp where wsp.id_aplicacao = ' || p_id_aplicacao || ') or ' ||
        'wspo.id_operacao in (select wso.id from controleacesso.ws_operacao wso where wso.id_aplicacao = ' || p_id_aplicacao || ');' || e'\r' || e'\r';
    end if;
    v_retorno := v_retorno || coalesce(v_sql_insert, '');

  end if; -- Verifica se os parametros foram passados

  -- retorna o resultado
  return v_retorno;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_limpa_acessos_expirados()">
      <src>CREATE OR REPLACE FUNCTION fc_limpa_acessos_expirados() 
  RETURNS text AS 
$$
declare
  v_tempo_validade_acesso interval default null;
  v_acessos_expirados integer default 0;
  v_sessoes_vazias integer default 0;
  v_retorno text default '';
begin
  -- Executa apenas uma instacia por vez
  if (
    select count(1) = 1
    FROM pg_stat_activity
    where current_query like '%controleacesso.fc_limpa_acessos_expirados(%'
  ) then
    -- Obtem o intervalo de validade do acesso
    select cast(controleacesso.fc_parametro_valor_text(1, 'tempo_validade_acesso') || ' minute' as interval) 
    into v_tempo_validade_acesso;

    -- Limpa os acessos expirados
    delete
    from controleacesso.acesso
    where ultimo_acesso &lt; (current_timestamp - v_tempo_validade_acesso);
    get diagnostics v_acessos_expirados = row_count;

    -- Limpa as sessoes vazias
    delete
    from controleacesso.sessao
    where
      id not in (
        select distinct id_sessao
        from controleacesso.acesso
      );
    get diagnostics v_sessoes_vazias = row_count;

    -- retorno
    v_retorno := to_char(current_timestamp, 'yyyy-mm-dd HH24:mi:ss') || 
      ' - Foram excluídos ' || v_acessos_expirados || ' acessos expirados e ' || 
      v_sessoes_vazias || ' sessões vazias';
  else
    -- retorno
    v_retorno := to_char(current_timestamp, 'yyyy-mm-dd HH24:mi:ss') || 
      ' - Outra instancia da rotina ainda esta executando';
  end if; -- Executa apenas uma instacia por vez

  -- retorno
  return v_retorno;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_parametro_aplicacao(p_id_aplicacao bigint)">
      <src>CREATE OR REPLACE FUNCTION fc_parametro_aplicacao(p_id_aplicacao bigint) 
  RETURNS SETOF controleacesso.type_fc_parametro_aplicacao AS 
$$
begin
  return query 
    with
      c (nome, descricao, id_tipo, valor)
      as (
        select nome, descricao, id_tipo, valor
        from controleacesso.parametro
        where id_aplicacao = p_id_aplicacao
      ),
      p (nome, descricao, id_tipo, valor)
      as (
        select *
        from c
        union
        select nome, descricao, id_tipo, valor
        from controleacesso.parametro
        where 
          id_aplicacao is null and
          nome not in (select nome from c)
      )
    select 
      p.nome, p.descricao, cast(tp.tipo as varchar(50)), p.valor
    from 
      p
      join controleacesso.vw_tipo_parametro tp on tp.id = p.id_tipo;
  return;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100
  ROWS 1000;</src>
    </Proc>
    <Proc nm="fc_parametro_valor_integer(p_id_aplicacao bigint, p_nome_parametro character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_parametro_valor_integer(p_id_aplicacao bigint, p_nome_parametro character varying) 
  RETURNS integer AS 
$$
begin
  -- retorno
  return cast(controleacesso.fc_parametro_valor_text(p_id_aplicacao, p_nome_parametro) as integer);
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_parametro_valor_text(p_id_aplicacao bigint, p_nome_parametro character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_parametro_valor_text(p_id_aplicacao bigint, p_nome_parametro character varying) 
  RETURNS text AS 
$$
declare
  v_valor text default null;
begin
  if p_id_aplicacao is null then
    raise exception 'Parâmetro p_id_aplicacao não pode ser nulo' using errcode = 'invalid_parameter_value';
  end if;
  
  -- Obtem o valor do parametro
  select p.valor
  into v_valor
  from controleacesso.parametro p
  where
    p.nome = p_nome_parametro and
    (p.id_aplicacao = p_id_aplicacao or p.id_aplicacao is null)
  order by id_aplicacao
  limit 1;
  
  -- retorno
  return v_valor;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_acesso_b_d()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_acesso_b_d() 
  RETURNS trigger AS 
$$
begin
  insert into controleacesso.acesso_historico
    (id_sessao, id_aplicacao, id_usuario, primeiro_acesso, ultimo_acesso)
  select 
    s.id, a.id_aplicacao, s.id_usuario, a.primeiro_acesso, a.ultimo_acesso
  from 
    controleacesso.acesso a
    join controleacesso.sessao s on s.id = a.id_sessao
  where
    a.id_sessao = old.id_sessao and
    a.id_aplicacao = old.id_aplicacao;

  return old;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_funcionalidade_b_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_funcionalidade_b_i() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o codigo da funcionalidade
  if NEW.codigo is null then
    NEW.codigo := NEW.id_aplicacao || '.' || NEW.id;
  end if;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_operacao_b_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_operacao_b_i() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o codigo da operacao
  if NEW.codigo is null then
    NEW.codigo := NEW.id_aplicacao || '.' || NEW.id_funcionalidade || '.' || NEW.id;
  end if;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_perfil_b_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_perfil_b_i() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o codigo do perfil
  if NEW.codigo is null then
    NEW.codigo := NEW.id_aplicacao || '.' || NEW.id;
  end if;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_usuario_a_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_usuario_a_i() 
  RETURNS trigger AS 
$$
begin
  -- Insere historico da situacao
  insert into controleacesso.historico_situacao
    (id_usuario, data, motivo, situacao)
  values(new.id, current_timestamp, 'Cadastro do usuário', new.situacao);

  -- retorno  
  return new;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_usuario_b_iu()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_usuario_b_iu() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o nome fonetico
  select fc_fon_fonetizar(NEW.nome), trim(NEW.login) into NEW.nome_fon, NEW.login;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_ws_operacao_b_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_ws_operacao_b_i() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o codigo
  if NEW.codigo is null then
    NEW.codigo := NEW.id_aplicacao || '.' || NEW.id;
  end if;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_trg_ws_perfil_b_i()">
      <src>CREATE OR REPLACE FUNCTION fc_trg_ws_perfil_b_i() 
  RETURNS trigger AS 
$$
begin
  -- Atualiza o codigo
  if NEW.codigo is null then
    NEW.codigo := NEW.id_aplicacao || '.' || NEW.id;
  end if;

  -- retorno  
  return NEW;  
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_usuarios_logados(p_id_orgao bigint, p_id_aplicacao bigint)">
      <src>CREATE OR REPLACE FUNCTION fc_usuarios_logados(p_id_orgao bigint, p_id_aplicacao bigint) 
  RETURNS SETOF controleacesso.type_usuarios_logados AS 
$$
/*
  Descricao:
    Lista os usuarios logados
  Uso:
  Lista os usuarios por orgao e aplicacao: passar o id do orgao ou aplicacao, ou null para incluir todos
  Lista os usuarios por aplicacao: passar -1 no parametro p_id_orgao, o id da aplicacao ou null para todas
  Lista os usuarios por orgao: passar -1 no parametro p_id_aplicacao, o id do orgao ou null para todos
  Lista os usuarios: passar -1 nos parametros p_id_aplicacao e p_id_orgao
*/
declare
  v_tempo_validade_acesso interval default null;
begin
  -- Obtem o intervalo de validade do acesso
  select cast(controleacesso.fc_parametro_valor_text(1, 'tempo_validade_acesso') || ' minute' as interval) 
  into v_tempo_validade_acesso;

  case
    -- Lista os usuarios por orgao e aplicacao
    when (p_id_orgao is null or p_id_orgao &lt;&gt; -1) and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
      return query 
        select 
          s.id_usuario, a.id_aplicacao, u.id_orgao,
          current_timestamp - a.primeiro_acesso,
          v_tempo_validade_acesso - (current_timestamp - a.ultimo_acesso)
        from
          controleacesso.acesso a
          join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
          join controleacesso.sessao s on s.id = a.id_sessao
            join controleacesso.usuario u on u.id = s.id_usuario
        where
          (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao) and
          (p_id_orgao is null or u.id_orgao = p_id_orgao);
    -- Lista os usuarios por aplicacao
    when p_id_orgao = -1 and (p_id_aplicacao is null or p_id_aplicacao &lt;&gt; -1) then
      return query 
        select 
          s.id_usuario, a.id_aplicacao, cast(null as bigint),
          current_timestamp - a.primeiro_acesso,
          v_tempo_validade_acesso - (current_timestamp - a.ultimo_acesso)
        from
          controleacesso.acesso a
          join controleacesso.aplicacao ap on ap.id = a.id_aplicacao
          join controleacesso.sessao s on s.id = a.id_sessao
        where
          (p_id_aplicacao is null or a.id_aplicacao = p_id_aplicacao);
    -- Lista os usuarios por orgao
    when p_id_aplicacao = -1 and (p_id_orgao is null or p_id_orgao &lt;&gt; -1) then
      return query 
        select
          l.id_usuario, cast(null as bigint), u.id_orgao,
          current_timestamp - l.primeiro_acesso,
          v_tempo_validade_acesso - (current_timestamp - l.ultimo_acesso)
        from 
          (
            select 
              s.id_usuario, min(a.primeiro_acesso) as primeiro_acesso, max(a.ultimo_acesso) as ultimo_acesso
            from
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
            group by s.id_usuario
          ) l
          join controleacesso.usuario u on u.id = l.id_usuario
        where
          (p_id_orgao is null or u.id_orgao = p_id_orgao);

    -- Lista os usuarios
    else 
      return query 
        select
          l.id_usuario, cast(null as bigint), cast(null as bigint),
          current_timestamp - l.primeiro_acesso,
          v_tempo_validade_acesso - (current_timestamp - l.ultimo_acesso)
        from 
          (
            select 
              s.id_usuario, min(a.primeiro_acesso) as primeiro_acesso, max(a.ultimo_acesso) as ultimo_acesso
            from
              controleacesso.acesso a
              join controleacesso.sessao s on s.id = a.id_sessao
            group by s.id_usuario
          ) l;
  end case;

  -- retorno
  return;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100
  ROWS 1000;</src>
    </Proc>
    <Proc nm="fc_validar_acesso(p_passaporte character varying, p_id_aplicacao bigint, p_login character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_validar_acesso(p_passaporte character varying, p_id_aplicacao bigint, p_login character varying) 
  RETURNS boolean AS 
$$
declare
  v_retorno boolean default false;
begin
  -- Localiza a sessao
  select true into v_retorno
  from 
    controleacesso.sessao s
    join controleacesso.usuario u on u.id = s.id_usuario
    join controleacesso.acesso a on a.id_sessao = s.id
  where
    s.passaporte = p_passaporte and
    a.id_aplicacao = p_id_aplicacao and
    (p_login is null or u.login = p_login);

  if v_retorno is null then 
    v_retorno := false;
  end if;

  -- retorno
  return v_retorno;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="fc_ws_operacoes_listar(p_login character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_ws_operacoes_listar(p_login character varying) 
  RETURNS SETOF character varying AS 
$$
declare
begin

  -- Atualiza data ultimo acesso do usuario
  update controleacesso.ws_usuario set
    ultimo_acesso = current_timestamp
  where
    login = p_login;

  -- retorno
  return query
    select o.codigo
    from 
      controleacesso.ws_usuario u
      join controleacesso.ws_usuario_ws_perfil up on u.id = up.id_usuario
        join controleacesso.ws_perfil_ws_operacao po on po.id_perfil = up.id_perfil 
          join controleacesso.ws_operacao o on o.id = po.id_operacao
        join controleacesso.ws_perfil p on p.id = up.id_perfil
    where 
      u.login = p_login and
      o.ativo = 1 and
      p.ativo = 1 and
      u.ativo = 1;

  return;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100
  ROWS 1000;</src>
    </Proc>
    <Proc nm="fc_ws_usuario_obter_senha(p_login character varying)">
      <src>CREATE OR REPLACE FUNCTION fc_ws_usuario_obter_senha(p_login character varying) 
  RETURNS character varying AS 
$$
declare
  v_retorno varchar default null;
begin
    select u.senha into v_retorno
    from 
      controleacesso.ws_usuario u
    where 
      u.login = p_login and
      u.ativo = 1;

  return v_retorno;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <Proc nm="sp_inativar_usuarios()">
      <src>CREATE OR REPLACE FUNCTION sp_inativar_usuarios() 
  RETURNS void AS 
$$
declare
  v_tempo_inativacao_usuario interval default null;
  r_usuario record;
begin
  -- Obtem o intervalo de inativacao de usuarios
  select cast(controleacesso.fc_parametro_valor_text(1, 'tempo_inativacao_usuario') || ' mons' as interval)
  into v_tempo_inativacao_usuario;

  -- Otem os usuarios que nao tem acesso no periodo
  for r_usuario in
    with
      u
      as (
        select id
        from
          controleacesso.usuario u
          left join controleacesso.acesso_historico ah on ah.id_usuario = u.id
        where
          u.situacao = 1
        group by u.id
        having max(ah.ultimo_acesso) &lt; current_date - v_tempo_inativacao_usuario
      ),
      hs
      as (
        select hs.id_usuario
        from controleacesso.historico_situacao hs
        where
          hs.situacao = 1
        group by hs.id_usuario
        having max(hs.data) &gt; current_date - v_tempo_inativacao_usuario
      )
    select u.id
    from u left join hs on hs.id_usuario = u.id
    where hs.id_usuario is null
  loop
    -- Atualiza situacao do usuario
    update controleacesso.usuario set
      situacao = 0
    where
      id = r_usuario.id;

    -- Inclui historico_situacao
    insert into controleacesso.historico_situacao
      (id_usuario, data, motivo, situacao)
    values
      (r_usuario.id, current_timestamp, 'Usuário(a) inativado(a) devido ao tempo sem acesso', 0);

  end loop;
end;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;</src>
    </Proc>
    <View nm="vw_perfil">
      <Sql>SELECT
    p.id AS id_perfil,
    p.descricao AS descricao_perfil,
    p.id_aplicacao
FROM controleacesso.perfil p</Sql>
    </View>
    <View nm="vw_tipo_documento">
      <Sql>SELECT
    0 AS id,
    'CPF' AS tipo_documento UNION SELECT 1 AS id,
    'Passaporte' AS tipo_documento</Sql>
    </View>
    <View nm="vw_tipo_parametro">
      <Sql>( SELECT
    1 AS id,
    'varchar' AS tipo UNION SELECT 2 AS id,
    'integer' AS tipo) UNION SELECT 3 AS id,
    'date' AS tipo</Sql>
    </View>
    <View nm="vw_usuario">
      <Sql>SELECT
    u.id,
    u.nome,
    td.tipo_documento,
    u.numero_documento,
    u.email,
    u.login,
    u.id_orgao,
    u.situacao
FROM controleacesso.usuario u
    JOIN controleacesso.vw_tipo_documento td ON td.id = u.tipo_documento</Sql>
    </View>
    <View nm="vw_usuario_aplicacao">
      <Sql>SELECT
    DISTINCT ON (u.id,
    p.id) u.id AS id_usuario,
    u.nome,
    td.tipo_documento,
    u.numero_documento,
    u.email,
    u.login,
    u.id_orgao,
    u.situacao AS usuario_situacao,
    p.id AS id_perfil,
    p.descricao AS descricao_perfil,
    p.ativo AS perfil_ativo,
    p.id_aplicacao
FROM controleacesso.usuario u
    JOIN controleacesso.vw_tipo_documento td ON td.id = u.tipo_documento
    JOIN controleacesso.usuario_perfil up ON up.id_usuario = u.id
    JOIN controleacesso.perfil p ON p.id = up.id_perfil</Sql>
    </View>
    <View nm="vw_usuario_aplicacao_perfil">
      <Sql>SELECT
    DISTINCT ON (u.id,
    a.id,
    p.id) u.id AS id_usuario,
    u.nome,
    td.tipo_documento,
    u.numero_documento,
    u.email,
    u.login,
    u.id_orgao,
    u.situacao AS usuario_situacao,
    a.id AS id_aplicacao,
    a.descricao AS descricao_aplicacao,
    p.id AS id_perfil,
    p.descricao AS descricao_perfil,
    p.ativo AS perfil_ativo
FROM controleacesso.usuario u
    JOIN controleacesso.vw_tipo_documento td ON td.id = u.tipo_documento
    JOIN controleacesso.usuario_perfil up ON up.id_usuario = u.id
    JOIN controleacesso.perfil p ON p.id = up.id_perfil
    JOIN controleacesso.aplicacao a ON a.id = p.id_aplicacao</Sql>
    </View>
    <Seq incr="1" nm="aplicacao_id_seq"/>
    <Seq incr="1" nm="funcionalidade_id_seq"/>
    <Seq incr="1" nm="operacao_id_seq"/>
    <Seq incr="1" nm="perfil_id_seq"/>
    <Seq incr="1" nm="sessao_id_seq"/>
    <Seq incr="1" nm="sq_configuracao"/>
    <Seq incr="1" nm="sq_historico_senha"/>
    <Seq incr="1" nm="sq_historico_situacao"/>
    <Seq incr="1" nm="sq_ws_operacao"/>
    <Seq incr="1" nm="sq_ws_perfil"/>
    <Seq incr="1" nm="sq_ws_usuario"/>
    <Seq incr="1" nm="usuario_id_seq"/>
    <CustomTypes>
      <CustomType id="5001" nm="lo"/>
    </CustomTypes>
  </Sch>
  <Dgm nm="autorizacao">
    <RnCf ClkAct="false" FtSz="9" lkStgy="OffsetDirect" zm="1.0">
      <VbCfg>
        <Fg ky="Auto Number" vl="0"/>
        <Fg ky="Check" vl="0"/>
        <Fg ky="Comment" vl="0"/>
        <Fg ky="Data Type" vl="1"/>
        <Fg ky="Default" vl="0"/>
        <Fg ky="ENUM Values" vl="0"/>
        <Fg ky="Length" vl="1"/>
        <Fg ky="Name" vl="1"/>
        <Fg ky="Nullable" vl="1"/>
        <Fg ky="Schema Name" vl="1"/>
        <Fg ky="Signed" vl="0"/>
      </VbCfg>
    </RnCf>
    <DiaProps>
      <Show AllCols="1" FkCols="1" FkNms="0" PkCols="1"/>
      <ErNotation>DbwErNotation</ErNotation>
      <svg path=""/>
    </DiaProps>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="sessao" x="59" y="153"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario" x="361" y="23"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_perfil" x="709" y="125"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_usuario_ws_perfil" x="703" y="370"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_usuario" x="360" y="352"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="acesso" x="57" y="245"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="acesso_historico" x="58" y="328"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="historico_situacao" x="363" y="228"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_perfil_aplicacao" x="708" y="247"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="historico_senha" x="697" y="26"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_complemento" x="32" y="54"/>
    <FkGl bkCl="ff000000" nm="controleacesso.acesso.fk_acesso_sessao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.historico_senha.fk_historico_senha_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.historico_situacao.fk_historico_situacao_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.sessao.fk_sessao_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_complemento.fk_usuario_complemento_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil.fk_usuario_perfil_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil_aplicacao.fk_usuario_perfil_aplicacao_usuario_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_usuario_ws_perfil.fk_ws_usuario_ws_perfil_ws_usuario"/>
    <Notes>
      <Note bkCl="ffffffe6" x="6" y="3">Projeto: Subsistema de controle de acesso
Visão: Autorização</Note>
    </Notes>
    <Zones/>
  </Dgm>
  <Dgm nm="configuracao">
    <RnCf ClkAct="false" FtSz="9" lkStgy="OffsetDirect" zm="1.0">
      <VbCfg>
        <Fg ky="Auto Number" vl="0"/>
        <Fg ky="Check" vl="0"/>
        <Fg ky="Comment" vl="0"/>
        <Fg ky="Data Type" vl="1"/>
        <Fg ky="Default" vl="0"/>
        <Fg ky="ENUM Values" vl="0"/>
        <Fg ky="Length" vl="1"/>
        <Fg ky="Name" vl="1"/>
        <Fg ky="Nullable" vl="1"/>
        <Fg ky="Schema Name" vl="1"/>
        <Fg ky="Signed" vl="0"/>
      </VbCfg>
    </RnCf>
    <DiaProps>
      <Show AllCols="1" FkCols="1" FkNms="0" PkCols="1"/>
      <ErNotation>DbwErNotation</ErNotation>
      <svg path=""/>
    </DiaProps>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="aplicacao" x="339" y="247"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="funcionalidade" x="669" y="342"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="operacao" x="669" y="178"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="perfil" x="398" y="40"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="perfil_operacao" x="721" y="78"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_perfil" x="116" y="59"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_operacao" x="14" y="309"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_perfil_ws_operacao" x="42" y="212"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="parametro" x="339" y="424"/>
    <FkGl bkCl="ff000000" nm="controleacesso.funcionalidade.fk_funcionalidade_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.operacao.fk_operacao_funcionalidade"/>
    <FkGl bkCl="ff000000" nm="controleacesso.parametro.fk_configuracao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil.fk_perfil_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil_operacao.fk_perfil_operacao_operacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil_operacao.fk_perfil_operacao_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_operacao.fk_ws_operacao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil.fk_ws_perfil_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil_ws_operacao.fk_ws_perfil_ws_operacao_ws_operacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil_ws_operacao.fk_ws_perfil_ws_operacao_ws_perfil"/>
    <Notes>
      <Note bkCl="ffffffe6" x="4" y="6">Projeto: Subsistema de controle de acesso
Visão: Configuração</Note>
    </Notes>
    <Zones/>
  </Dgm>
  <Dgm nm="geral">
    <RnCf ClkAct="false" FtSz="9" lkStgy="OffsetDirect" zm="1.0">
      <VbCfg>
        <Fg ky="Auto Number" vl="0"/>
        <Fg ky="Check" vl="0"/>
        <Fg ky="Comment" vl="0"/>
        <Fg ky="Data Type" vl="1"/>
        <Fg ky="Default" vl="0"/>
        <Fg ky="ENUM Values" vl="0"/>
        <Fg ky="Length" vl="1"/>
        <Fg ky="Name" vl="1"/>
        <Fg ky="Nullable" vl="1"/>
        <Fg ky="Schema Name" vl="1"/>
        <Fg ky="Signed" vl="0"/>
      </VbCfg>
    </RnCf>
    <DiaProps>
      <Show AllCols="0" FkCols="1" FkNms="0" PkCols="1"/>
      <ErNotation>DbwErNotation</ErNotation>
      <svg path=""/>
    </DiaProps>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="aplicacao" x="694" y="306"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="funcionalidade" x="806" y="163"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="operacao" x="925" y="306"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="perfil" x="695" y="84"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="perfil_operacao" x="934" y="79"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="usuario" x="80" y="175"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="usuario_perfil" x="287" y="154"/>
    <TbGl bkCl="ffffffe6" sch="controleacesso" tbl="sessao" x="10" y="362"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_usuario" x="17" y="496"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_usuario_ws_perfil" x="266" y="468"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_perfil" x="604" y="402"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_perfil_ws_operacao" x="716" y="482"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="ws_operacao" x="817" y="400"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="acesso_historico" x="11" y="424"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="acesso" x="279" y="380"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="historico_situacao" x="16" y="72"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_perfil_aplicacao" x="254" y="261"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_complemento" x="258" y="74"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="parametro" x="576" y="207"/>
    <FkGl bkCl="ff000000" nm="controleacesso.acesso.fk_acesso_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.acesso.fk_acesso_sessao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.funcionalidade.fk_funcionalidade_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.historico_situacao.fk_historico_situacao_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.operacao.fk_operacao_funcionalidade"/>
    <FkGl bkCl="ff000000" nm="controleacesso.parametro.fk_configuracao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil.fk_perfil_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil_operacao.fk_perfil_operacao_operacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.perfil_operacao.fk_perfil_operacao_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.sessao.fk_sessao_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_complemento.fk_usuario_complemento_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil.fk_usuario_perfil_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil.fk_usuario_perfil_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil_aplicacao.fk_usuario_perfil_aplicacao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_perfil_aplicacao.fk_usuario_perfil_aplicacao_usuario_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_operacao.fk_ws_operacao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil.fk_ws_perfil_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil_ws_operacao.fk_ws_perfil_ws_operacao_ws_operacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_perfil_ws_operacao.fk_ws_perfil_ws_operacao_ws_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_usuario_ws_perfil.fk_ws_usuario_ws_perfil_ws_perfil"/>
    <FkGl bkCl="ff000000" nm="controleacesso.ws_usuario_ws_perfil.fk_ws_usuario_ws_perfil_ws_usuario"/>
    <Notes>
      <Note bkCl="ffffffe6" x="3" y="3">Projeto: Subsistema de controle de acesso
Visão: Geral</Note>
    </Notes>
    <Zones>
      <Zone bkCl="fffefefe" h="513" nm="Autorizacao" w="509" x="5" y="46"/>
      <Zone bkCl="fffefefe" h="624" nm="Configuracao" w="507" x="523" y="47"/>
    </Zones>
  </Dgm>
  <Dgm nm="suporte_natural">
    <RnCf ClkAct="true" FtSz="9" lkStgy="OffsetDirect" zm="1.0">
      <VbCfg>
        <Fg ky="Auto Number" vl="0"/>
        <Fg ky="Check" vl="0"/>
        <Fg ky="Comment" vl="0"/>
        <Fg ky="Data Type" vl="1"/>
        <Fg ky="Default" vl="0"/>
        <Fg ky="ENUM Values" vl="0"/>
        <Fg ky="Length" vl="1"/>
        <Fg ky="Name" vl="1"/>
        <Fg ky="Nullable" vl="1"/>
        <Fg ky="Schema Name" vl="1"/>
        <Fg ky="Signed" vl="0"/>
      </VbCfg>
    </RnCf>
    <DiaProps>
      <Show AllCols="1" FkCols="1" FkNms="1" PkCols="1"/>
      <ErNotation>DbwErNotation</ErNotation>
      <svg path=""/>
    </DiaProps>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="aplicacao" x="28" y="35"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario" x="707" y="31"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_aplicacao" x="372" y="70"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="servico" x="24" y="233"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="broker" x="655" y="393"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="servicorpc" x="377" y="395"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="servico_servicoRPC" x="100" y="395"/>
    <TbGl bkCl="ffccccff" sch="controleacesso" tbl="usuario_servico" x="475" y="281"/>
    <FkGl bkCl="ff000000" nm="controleacesso.servico.fk_servicos_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.servico_servicoRPC.fk_servico_servicoRPC_servicorpc"/>
    <FkGl bkCl="ff000000" nm="controleacesso.servico_servicoRPC.fk_servico_servicoRPC_servicos"/>
    <FkGl bkCl="ff000000" nm="controleacesso.servicorpc.fk_servicorpc_broker"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_aplicacao.fk_usuario_aplicacao_aplicacao"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_aplicacao.fk_usuario_aplicacao_usuario"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_servico.fk_usuario_servico_servicos"/>
    <FkGl bkCl="ff000000" nm="controleacesso.usuario_servico.fk_usuario_servico_usuario"/>
    <Notes/>
    <Zones/>
  </Dgm>
  <RnmMgr NxRnmId="38">
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="patrimonio" SupCls="Schema" SupNme="sispat">
      <Rnm id="1" nNm="id_ultima_ocorrencia" oNm="id_ulitima_ocorrencia"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="sessao" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="2" nNm="id" oNm="sessaoId"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="sessao" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="3" nNm="passaporte" oNm="InsertBy"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="sessao" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="5" nNm="data_login" oNm="dthr_login"/>
      <Rnm id="4" nNm="dthr_login" oNm="InsertTime"/>
    </RnmCh>
    <RnmCh ObjCls="Table" ParCls="Schema" ParNme="controleacesso" SupCls="" SupNme="">
      <Rnm id="6" nNm="sessao_historico" oNm="historico_sessao"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="patrimonio" SupCls="Schema" SupNme="sispat">
      <Rnm id="7" nNm="id_registro" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="sequencial" SupCls="Schema" SupNme="sispat">
      <Rnm id="8" nNm="id_registro" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="baixa_patrimonio" SupCls="Schema" SupNme="sispat">
      <Rnm id="10" nNm="id_registro" oNm="id_patrimonio"/>
      <Rnm id="9" nNm="id_patrimonio" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="cessao" SupCls="Schema" SupNme="sispat">
      <Rnm id="14" nNm="id_bem" oNm="id"/>
      <Rnm id="13" nNm="id" oNm="id_bem"/>
      <Rnm id="11" nNm="id_bem" oNm="id_cessao"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="doacao" SupCls="Schema" SupNme="sispat">
      <Rnm id="12" nNm="id_bem" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="documento" SupCls="Schema" SupNme="sispat">
      <Rnm id="15" nNm="id_bem" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="producao_propria" SupCls="Schema" SupNme="sispat">
      <Rnm id="16" nNm="id_bem" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="compra" SupCls="Schema" SupNme="sispat">
      <Rnm id="17" nNm="id_bem" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="locacao" SupCls="Schema" SupNme="sispat">
      <Rnm id="18" nNm="id_entidade" oNm="id_entidade_externa"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="entidade_externa_orgao" SupCls="Schema" SupNme="sispat">
      <Rnm id="19" nNm="id_entidade" oNm="id_entidade_externa"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="termo_manutencao" SupCls="Schema" SupNme="sispat">
      <Rnm id="20" nNm="data" oNm="datatermo_manutencao"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="relacao_bens_inserviveis" SupCls="Schema" SupNme="sispat">
      <Rnm id="22" nNm="numero" oNm="nome"/>
    </RnmCh>
    <RnmCh ObjCls="Table" ParCls="Schema" ParNme="sispat" SupCls="" SupNme="">
      <Rnm id="23" nNm="comissao_avaliacao" oNm="comicao_avaliacao"/>
    </RnmCh>
    <RnmCh ObjCls="Table" ParCls="Schema" ParNme="eprotocolo" SupCls="" SupNme="">
      <Rnm id="24" nNm="distribuicao" oNm="Distribuicao"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="rotina" SupCls="Schema" SupNme="sispat">
      <Rnm id="25" nNm="classe_rotina" oNm="nome"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="plano_execucao" SupCls="Schema" SupNme="sispat">
      <Rnm id="26" nNm="id_tarefa" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="agenda" SupCls="Schema" SupNme="sispat">
      <Rnm id="27" nNm="expressao" oNm="nome"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="tarefa_execucao" SupCls="Schema" SupNme="sispat">
      <Rnm id="30" nNm="data_inicio" oNm="inicio"/>
      <Rnm id="28" nNm="inicio" oNm="UpdateTime"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="tarefa_execucao" SupCls="Schema" SupNme="sispat">
      <Rnm id="31" nNm="data_fim" oNm="fim"/>
      <Rnm id="29" nNm="fim" oNm="InsertTime"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="distribuicao" SupCls="Schema" SupNme="eprotocolo">
      <Rnm id="32" nNm="dataretorno" oNm="dataRetorno"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="distribuicao" SupCls="Schema" SupNme="eprotocolo">
      <Rnm id="33" nNm="datarecebimento" oNm="dataRecebimento"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="usuario_perfil_aplicacao" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="34" nNm="id_usuario" oNm="id"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="usuario" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="35" nNm="situacao" oNm="ativo"/>
    </RnmCh>
    <RnmCh ObjCls="Table" ParCls="Schema" ParNme="controleacesso" SupCls="" SupNme="">
      <Rnm id="36" nNm="servico" oNm="servicos"/>
    </RnmCh>
    <RnmCh ObjCls="Column" ParCls="Table" ParNme="usuario_aplicacao" SupCls="Schema" SupNme="controleacesso">
      <Rnm id="37" nNm="cd_usuario_natural" oNm="id_usuario_natural"/>
    </RnmCh>
  </RnmMgr>
  <DbDocOptionMgr>
    <BasicOptionMgr>
      <Name>db.doc.option.mgr</Name>
      <BoolOpt lbl="Diagrams" nm="doc.diagrams" on="1" spl="0"/>
      <BoolOpt lbl="Foreign Keys" nm="doc.fks" on="1" spl="0"/>
      <BoolOpt lbl="Indexes" nm="doc.indexes" on="1" spl="0"/>
      <BoolOpt lbl="Overwrite CSS File" nm="doc.overwrite.css" on="1" spl="0"/>
      <BoolOpt lbl="Procedures" nm="doc.procs" on="1" spl="0"/>
      <BoolOpt lbl="Schemas" nm="doc.schemas" on="1" spl="0"/>
      <BoolOpt lbl="Sequences" nm="doc.sequences" on="1" spl="0"/>
      <BoolOpt lbl="Tables" nm="doc.tables" on="1" spl="1"/>
      <BoolOpt lbl="Triggers" nm="doc.triggers" on="1" spl="0"/>
      <BoolOpt lbl="Views" nm="doc.views" on="1" spl="0"/>
    </BasicOptionMgr>
  </DbDocOptionMgr>
  <OpenEditors>
    <OpenEditor ClsNm="Diagram" fqn="corporativo.suporte_natural" selected="1"/>
    <OpenEditor ClsNm="Diagram" fqn="corporativo.configuracao" selected="0"/>
    <OpenEditor ClsNm="Diagram" fqn="corporativo.geral" selected="0"/>
    <OpenEditor ClsNm="Diagram" fqn="corporativo.autorizacao" selected="0"/>
  </OpenEditors>
  <TreePaths>
    <TreePath/>
    <TreePath>/Diagrams (4)</TreePath>
    <TreePath>/Diagrams (4)/suporte_natural</TreePath>
  </TreePaths>
</Db>
